# Crack Propagation Simulation (Nibbling Algorithm Visualization)

Этот проект представляет собой визуальную симуляцию распространения трещин в двумерной решетке конечных элементов на языке JavaScript с использованием библиотеки p5.js. Модель реализует упрощённую версию *Nibbling Algorithm* — итерационного подхода к моделированию разрушения, основанного на снижении жесткости поврежденных элементов.

## Описание метода

Nibbling Algorithm — это методика приближенного моделирования роста трещин, не требующая применения классических понятий механики разрушения, таких как коэффициенты интенсивности напряжений (SIF) или траектории трещин. Метод позволяет получать положение фронта трещины на каждой итерации расчёта. Используется следующий подход:

1. Каждому конечному элементу (далее КЭ) присваивается напряжение.
2. На каждой итерации рассчитывается распределение напряжений в модели.
3. Элементы, напряжение в которых превышает определённую долю от максимального (порог разрушения `σ ≥ fS * σ_max`), исключаются из модели.
4. Исключение реализуется путём принудительного "обнуления" их механических свойств (в симуляции — через флаг `broken`).
5. Модель пересчитывается и процесс повторяется.

Метод описан в работе:

> Peng D., Huanga P., Jones R., Bowlerb A., Edwards D.  
> *A simple method based for computing crack shapes*,  
> *Engineering Failure Analysis*, 2016, No. 59, pp. 41–56.

Этот подход позволяет эффективно предсказывать форму и развитие зоны разрушения без сложной перенумерации сетки или работы с сингулярностями. Он не показывает как точно будет распространяться трещина, но дает возможность для общей оценки.

## Идея

В центре модели — сетка ячеек, каждая из которых может испытывать напряжение и разрушаться, если превышен порог. Пользователь может задавать начальное напряжение, параметры затухания и коэффициент разрушения, после чего наблюдать, как трещины распространяются по материалу с течением времени.

## Основные параметры:

- sigma0 — начальное напряжение, которое задаётся вручную на ячейках.
- decay — коэффициент затухания напряжения при удалении от источника.
- fS — коэффициент разрушения: определяет, при каком напряжении ячейка ломается.

## Что происходит в симуляции

### 1. Задание начальных условий

- Перед запуском симуляции пользователь кликает по ячейкам на сетке, чтобы задать им стартовое напряжение (`σ₀`). Эти ячейки становятся источниками напряжения, подобно точкам приложения силы в реальных материалах.
- Напряжение от этих точек будет распространяться на другие ячейки в зависимости от расстояния и параметров модели.

### 2. Расчёт на каждом шаге

После нажатия на кнопку Следующий шаг, происходит симуляция одного этапа распространения напряжения и возможного разрушения:

#### a) Распределение напряжения

- Каждая неповреждённая ячейка получает вклад напряжения от всех других ячеек.
- Напряжение уменьшается с расстоянием по экспоненциальному закону, моделируя затухание, как в физических системах: ближние ячейки влияют сильнее, дальние — слабее.
- Итоговое напряжение в ячейке — это сумма вкладов от всех других.

#### b) Определение порога разрушения

- После вычисления всех значений напряжения, система находит максимальное значение (`σₘₐₓ`) среди всех ячеек.
- Затем высчитывается порог разрушения:  
  порог = fS × σₘₐₓ,  
  где fS — коэффициент прочности материала. Чем он ниже, тем быстрее наступает разрушение.

#### c) Учет накопленного повреждения (damage)

- Если напряжение в ячейке превышает порог, её внутренний параметр damage увеличивается.
- Даже если ячейка не разрушилась сразу, накопление damage с шагами может привести к разрушению позже.
- Если напряжение в ячейке не превышает порог, её damage частично восстанавливается, моделируя "усталость материала".

#### d) Условия разрушения

- Ячейка считается готовой к разрушению, если:
  - Её damage достиг значения 1 (максимальное накопленное повреждение),  
  - И все её соседи уже разрушены — это моделирует эффект «висячей точки», оставшейся без поддержки.
- Такие ячейки помечаются для разрушения и разрушаются на следующем шаге.

---

## Визуализация состояния ячеек

Цвет каждой ячейки отображает её текущее состояние и поведение в процессе:

| Цвет                       | Значение и интерпретация |
|----------------------------|--------------------------|
| Белый                 | Ячейка без напряжения. Состояние покоя. |
| Жёлтый → оранжевый → красный | Градиент, отображающий уровень текущего напряжения (`stress`). Чем краснее — тем выше нагрузка. |
| Голубой               | Ячейка будет разрушена на следующем шаге. Она достигла порога. |
| Фиолетовый            | Ячейка находится под накопленным повреждением (`damage > 0`). Ещё не разрушена, но её ресурс на исходе. |
| Чёрный                | Ячейка разрушена — она больше не участвует в передаче напряжения. |
| Тёмно-серый контур    | Разрушенные ячейки выделены более толстой рамкой, чтобы их можно было легко отличить. |

---
## Используемые концепции

- Переменные и массивы: grid, history, newStress и др. хранят информацию о состоянии модели.
- Циклы: вложенные `for`-циклы используются для итерации по сетке и вычисления напряжения.
- Условия (`if`): применяются для проверки, разрушена ли ячейка, достигнут ли порог и т.д.
- Функции:
  - simulateFracture() — основной шаг симуляции.
  - undoFracture() — откат назад.
  - resetGrid() — сброс всей сетки.
  - colorForStress() — раскраска в зависимости от напряжения и состояния.

## Тестовые сценарии (Manual Tests)

### Тест 1: Распространение от одиночной ячейки
Цель: убедиться, что разрушение распространяется от источника напряжения.

Шаги:
1. Установите sigma0 = 50, decay = 0.2, fS = 0.9.
2. Кликните по одной центральной ячейке (примерно в середине сетки).
3. Нажимайте «Следующий шаг» несколько раз.

Ожидание:
- Трещина распространяется постепенно.
- Цвета постепенно меняются от красного к оранжевому и желтому.
- Центр разрушен, далее — фронт разрушения.

Гиф-анимация:

![тест1](gifs/p5.gif)

---

### Тест 2: Повышение decay замедляет распространение

Шаги:
1. Протестируйте при decay = 0.01 и decay = 0.3 (остальные параметры те же).
2. Кликните одну ячейку и нажмите «Следующий шаг» несколько раз.

Ожидание:
- При низком decay разрушение охватывает больше ячеек.
- При высоком — слабо распространяется от источника.

Гиф-анимация:

- ![demo1](media/demo1.gif)
- 
---

### Тест 3: Накопление разрушений

Шаги:
1. sigma0 = 25, fS = 0.95, decay = 0.25.
2. Кликните несколько соседних ячеек.
3. Нажмите «Следующий шаг» 4–5 раз.

Ожидание:
- Ячейки с умеренным напряжением накапливают стресс и разрушаются на 2–4 итерации.
- Цвет: красный → фиолетовый → разрушение.

Гиф-анимация:

- ![demo1](media/demo1.gif)

---

### Тест 4: Изолированные ячейки

Шаги:
1. Создайте круг из разрушенных ячеек.
2. Внутрь круга добавьте одну неповреждённую ячейку.
3. Примените шаги симуляции.

Ожидание:
- Изолированная ячейка разрушается, даже если стресс мал.
- Цвет: серый перед разрушением.

Гиф-анимация:

- ![demo1](media/demo1.gif)

---

### Тест 5: Проверка интерфейса

Шаги:
1. Используйте кнопки «Шаг назад», «Сбросить всё».
2. Примените несколько шагов, затем откатите.

Ожидание:
- Состояние корректно возвращается на шаг назад или к изначальной сетке.

Гиф-анимация:

- ![demo1](media/demo1.gif)

---

## Возможности для расширения

- Моделирование анизотропии материала;
- Поддержка нескольких типов напряжений;
- Экспорт в изображение или гиф-анимацию.
